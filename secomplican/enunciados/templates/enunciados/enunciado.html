{% extends "base.html" %}
{% block content %}

{% load urls_conjuntos %}
{% load urls_enunciados %}

{% include "enunciados/header_enunciado.html" %}

<script src="https://cdn.jsdelivr.net/npm/js-cookie@beta/dist/js.cookie.min.js"></script>
<script type="text/javascript">
    const csrftoken = Cookies.get('csrftoken');

    function hacerPostAUrlYActualizarPuntos(url, idElemento) {
        const puntosElement = document.getElementById(idElemento);
        var request = new Request(url);

        fetch(request, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrftoken,
            }
        }).then(function(response) {
            if (response.status === 200) {
                const puntos = response.headers.get('Puntos');
                puntosElement.innerHTML = puntos;
            }
        });
    }

    function upvote(idSolucion) {
        hacerPostAUrlYActualizarPuntos(
            '/soluciones/' + idSolucion + '/votos/arriba/', 'puntos-' + idSolucion);
    }

    function removeVote(idSolucion) {
        hacerPostAUrlYActualizarPuntos(
            '/soluciones/' + idSolucion + '/votos/sacar/', 'puntos-' + idSolucion);
    }

    function downvote(idSolucion) {
        hacerPostAUrlYActualizarPuntos(
            '/soluciones/' + idSolucion + '/votos/abajo/', 'puntos-' + idSolucion);
    }
</script>


<a class="mr-3"
    href="{% url_editar_enunciado materia_carrera enunciado %}">
    <span class="fas fa-pen"></span> Editar
</a>
<a href="{% url_versiones_enunciado materia_carrera enunciado %}">
    <span class="fas fa-undo"></span> Versiones anteriores
</a>

<h2 class="mt-4"> Soluciones </h2>
<hr>
{% for solucion in enunciado.soluciones.all %}
    Puntos: <div id='puntos-{{ solucion.id }}'>{{ solucion.puntos }}</div>
    <button onclick="upvote({{ solucion.id }})">
        Votar arriba
    </button>
    <button onclick="removeVote({{ solucion.id }})">
        Sacar voto
    </button>
    <button onclick="downvote({{ solucion.id }})">
        Votar abajo
    </button>
    <div class="mb-4">
        <p>
            {{ solucion|linebreaks }}
        </p>
        {% include 'enunciados/acciones_solucion.html' %}
        <hr>
    </div>
{% empty %}
    <p>Todavía no hay soluciones.</p>
{% endfor %}

<a class="btn btn-primary mb-4 font-weight-bold" href="{{ url_agregar_solucion }}">
    + Agregar solución
</a>

{% endblock %}
